import{a as x,p as ce,m as me,o as pe,b as ve,g as _e,u as fe,c as be,d as ge,e as $,f as he,h as ye,V as ee,i as te,j as p,k as G,l as I,n as c,q as h,r as g,t as B,s as n,_ as k,F as P,v as W,w as C,x as N,y as A,z as f,A as V,B as we,C as D,D as Ve,E as ae,G as Ce,H as se,I as xe,J as Ie,K as ne,L as ke,M as Se,N as le,O as oe,P as J,Q as ie,R as re,S as Be,T as $e,U as Ue,W as Ee,X as Fe}from"./index.3894736b.js";const{Axios:Ct,AxiosError:Le,CanceledError:xt,isCancel:It,CancelToken:kt,VERSION:St,all:Bt,Cancel:$t,isAxiosError:Ut,spread:Et,toFormData:Ft,AxiosHeaders:Lt,HttpStatusCode:At,formToJSON:Dt,getAdapter:Pt,mergeConfig:Nt}=x;const Ae=ce({...me(),...pe(ve(),["inline"])},"VCheckbox"),De=_e()({name:"VCheckbox",inheritAttrs:!1,props:Ae(),emits:{"update:modelValue":d=>!0,"update:focused":d=>!0},setup(d,o){let{attrs:e,slots:l}=o;const i=fe(d,"modelValue"),{isFocused:t,focus:a,blur:s}=be(d),r=ge(),u=$(()=>d.id||`checkbox-${r}`);return he(()=>{const[b,m]=ye(e),y=ee.filterProps(d),T=te.filterProps(d);return p(ee,G({class:["v-checkbox",d.class]},b,y,{modelValue:i.value,"onUpdate:modelValue":E=>i.value=E,id:u.value,focused:t.value,style:d.style}),{...l,default:E=>{let{id:q,messagesId:z,isDisabled:O,isReadonly:j,isValid:R}=E;return p(te,G(T,{id:q.value,"aria-describedby":z.value,disabled:O.value,readonly:j.value},m,{error:R.value===!1,modelValue:i.value,"onUpdate:modelValue":H=>i.value=H,onFocus:a,onBlur:s}),l)}})}),{}}}),Pe={class:"install-view-license"},Ne={class:"install-view-license-content"},Me=I({__name:"InstallViewLicense",setup(d,{expose:o}){const e=U();return o({nextBtn:{label:"Accept"}}),(l,i)=>(c(),h("div",Pe,[g("div",Ne,B(n(e).license),1)]))}});const Te=k(Me,[["__scopeId","data-v-4019f6dd"]]),qe={class:"install-view-environment"},ze={style:{display:"flex",gap:"8px","flex-wrap":"wrap"}},Oe={class:"install-view-environment-item-title"},je={key:0,class:"install-view-environment-item-message"},Re=I({__name:"InstallViewEnvironment",setup(d,{expose:o}){const e=U(),l=$(()=>e.environment&&Object.values(e.environment).every(t=>t.status===1)),i=$(()=>l.value?"Next":"Recheck");return o({nextBtn:{label:i,action:()=>{l.value?e.nextStep():e.recheckEnvironment()}}}),(t,a)=>(c(),h("div",qe,[(c(!0),h(P,null,W(n(e).environment,(s,r)=>(c(),h("div",{key:r,class:"install-view-environment-item"},[s.status===1?(c(),C(N,{key:0,icon:"mdi-check-circle",color:"#097c31",size:"20"})):(c(),C(N,{key:1,icon:"mdi-close-circle",color:"#ac0221",size:"20"})),g("div",ze,[g("span",Oe,B(s.label),1),s.message?(c(),h("span",je,B(s.message),1)):A("",!0)])]))),128))]))}});const He=k(Re,[["__scopeId","data-v-ec046cca"]]),Ge={class:"install-view-database-config"},Je=I({__name:"InstallViewDatabaseConfig",setup(d,{expose:o}){const e=U(),l=f({dbname:"",host:"",port:"",username:""});return o({nextBtn:{action:async()=>{await e.validateDb()&&e.nextStep()}},validate:()=>{var t,a,s;l.value={dbname:"",host:"",port:"",username:""};let i=!0;return(t=e.databaseConfig.dbname)!=null&&t.trim()||(l.value.dbname="Field is required",i=!1),(a=e.databaseConfig.host)!=null&&a.trim()||(l.value.host="Field is required",i=!1),e.databaseConfig.port||(l.value.port="Field is required",i=!1),(s=e.databaseConfig.username)!=null&&s.trim()||(l.value.username="Field is required",i=!1),i}}),(i,t)=>(c(),h("div",Ge,[p(V,{modelValue:n(e).databaseConfig.dbname,"onUpdate:modelValue":t[0]||(t[0]=a=>n(e).databaseConfig.dbname=a),label:"Database name",variant:"outlined",density:"comfortable","error-messages":l.value.dbname,"hide-details":"auto"},null,8,["modelValue","error-messages"]),p(V,{modelValue:n(e).databaseConfig.host,"onUpdate:modelValue":t[1]||(t[1]=a=>n(e).databaseConfig.host=a),label:"Database host",variant:"outlined",density:"comfortable","error-messages":l.value.host,"hide-details":"auto"},null,8,["modelValue","error-messages"]),p(V,{modelValue:n(e).databaseConfig.port,"onUpdate:modelValue":t[2]||(t[2]=a=>n(e).databaseConfig.port=a),label:"Database port",variant:"outlined",density:"comfortable","error-messages":l.value.port,"hide-details":"auto"},null,8,["modelValue","error-messages"]),p(V,{modelValue:n(e).databaseConfig.username,"onUpdate:modelValue":t[3]||(t[3]=a=>n(e).databaseConfig.username=a),label:"Username",variant:"outlined",density:"comfortable","error-messages":l.value.username,"hide-details":"auto"},null,8,["modelValue","error-messages"]),p(V,{modelValue:n(e).databaseConfig.password,"onUpdate:modelValue":t[4]||(t[4]=a=>n(e).databaseConfig.password=a),type:"password",label:"Password (optional)",variant:"outlined",density:"comfortable",autocomplete:"one-time-code","hide-details":"auto"},null,8,["modelValue"]),p(we,{modelValue:n(e).databaseConfig.collation,"onUpdate:modelValue":t[5]||(t[5]=a=>n(e).databaseConfig.collation=a),items:n(M).db_collations,label:"Database collation",variant:"outlined",density:"comfortable","hide-details":"auto"},null,8,["modelValue","items"])]))}});const We=k(Je,[["__scopeId","data-v-38e4ac00"]]),Xe={class:"install-view-elastic-config"},Ke=I({__name:"InstallViewElasticConfig",setup(d,{expose:o}){const e=U(),l=f({host:"",port:""});return o({nextBtn:{action:async()=>{await e.validateElastic()&&e.nextStep()}},validate:()=>{var t;l.value={host:"",port:""};let i=!0;return(t=e.elasticConfig.host)!=null&&t.trim()||(l.value.host="Field is required",i=!1),e.elasticConfig.port||(l.value.port="Field is required",i=!1),i}}),(i,t)=>(c(),h("div",Xe,[p(V,{modelValue:n(e).elasticConfig.host,"onUpdate:modelValue":t[0]||(t[0]=a=>n(e).elasticConfig.host=a),label:"Elastic host",variant:"outlined",density:"comfortable","error-messages":l.value.host,"hide-details":"auto"},null,8,["modelValue","error-messages"]),p(V,{modelValue:n(e).elasticConfig.port,"onUpdate:modelValue":t[1]||(t[1]=a=>n(e).elasticConfig.port=a),label:"Elastic port",variant:"outlined",density:"comfortable","error-messages":l.value.port,"hide-details":"auto"},null,8,["modelValue","error-messages"]),p(V,{modelValue:n(e).elasticConfig.username,"onUpdate:modelValue":t[2]||(t[2]=a=>n(e).elasticConfig.username=a),label:"Username (optional)",variant:"outlined",density:"comfortable","hide-details":""},null,8,["modelValue"]),p(V,{modelValue:n(e).elasticConfig.password,"onUpdate:modelValue":t[3]||(t[3]=a=>n(e).elasticConfig.password=a),type:"password",label:"Password (optional)",variant:"outlined",density:"comfortable",autocomplete:"one-time-code","hide-details":""},null,8,["modelValue"])]))}});const Qe=k(Ke,[["__scopeId","data-v-166cc1bb"]]),Ye={class:"install-view-site-config"},Ze={class:"install-view-dummy-data"},et={class:"install-view-dummy-data-help"},tt=I({__name:"InstallViewSiteConfig",setup(d,{expose:o}){const e=U(),l=f(!1),i=f({url:"",username:"",password:""});return o({validate:()=>{var a,s,r;i.value={url:"",username:"",password:""};let t=!0;return(a=e.siteConfig.url)!=null&&a.trim()||(i.value.url="Field is required",t=!1),(s=e.siteConfig.username)!=null&&s.trim()||(i.value.username="Field is required",t=!1),(r=e.siteConfig.password)!=null&&r.trim()||(i.value.password="Field is required",t=!1),t}}),(t,a)=>(c(),h("div",Ye,[p(V,{modelValue:n(e).siteConfig.url,"onUpdate:modelValue":a[0]||(a[0]=s=>n(e).siteConfig.url=s),label:"Site URL",variant:"outlined",density:"comfortable","error-messages":i.value.url,"hide-details":"auto"},null,8,["modelValue","error-messages"]),p(V,{modelValue:n(e).siteConfig.username,"onUpdate:modelValue":a[1]||(a[1]=s=>n(e).siteConfig.username=s),label:"Admin username",variant:"outlined",density:"comfortable","error-messages":i.value.username,"hide-details":"auto"},null,8,["modelValue","error-messages"]),p(V,{modelValue:n(e).siteConfig.password,"onUpdate:modelValue":a[2]||(a[2]=s=>n(e).siteConfig.password=s),type:l.value?"text":"password",label:"Admin password",variant:"outlined",density:"comfortable",autocomplete:"one-time-code","append-inner-icon":l.value?"mdi-eye-off":"mdi-eye","onClick:appendInner":a[3]||(a[3]=s=>l.value=!l.value),"error-messages":i.value.password,"hide-details":"auto"},null,8,["modelValue","type","append-inner-icon","error-messages"]),g("div",Ze,[p(De,{modelValue:n(e).siteConfig.demodata,"onUpdate:modelValue":a[4]||(a[4]=s=>n(e).siteConfig.demodata=s),color:"secondary",label:"Import dummy data","hide-details":""},null,8,["modelValue"]),p(Ve,{location:"top start",text:"A set of dummy records will be installed on your system for demonstration purposes."},{activator:D(({props:s})=>[g("div",et,[p(N,G(s,{icon:"mdi-help",size:"14",color:"white"}),null,16)])]),_:1})])]))}});const at=k(tt,[["__scopeId","data-v-e0e38c7c"]]),st={class:"install-view-installation"},nt={class:"installation-step-label"},lt=I({__name:"InstallViewInstallation",setup(d,{expose:o}){const e=U(),l=f({}),i=f(null),t=f(null);o({prevBtn:!1,nextBtn:!1}),ae(async()=>{e.install(),await a(),t.value=setInterval(async()=>{await a()},1e3)}),Ce(()=>{t.value&&clearInterval(t.value)});async function a(){var r;try{const u=await x.get("api/install/status");Object.keys(u.data||{}).length!==Object.keys(l.value).length&&(l.value=u.data||{})}catch(u){u instanceof Le&&((r=u.response)==null?void 0:r.status)===404&&(e.isInstallationCompleted=!0)}}const s=$(()=>{var r;return Object.keys((r=l.value)!=null?r:{}).length?Object.keys(l.value).map(u=>parseInt(u)).sort((u,b)=>u<b?1:u>b?-1:0)[0]:0});return se(()=>l.value,async()=>{var r;await xe(),(r=i.value)==null||r.scrollTo({behavior:"smooth",left:0,top:i.value.scrollHeight})}),(r,u)=>(c(),h("div",st,[p(Ie,{color:"primary",stream:"","rounded-bar":"",rounded:"",height:"6",style:{"min-height":"6px"},"model-value":s.value,max:21},null,8,["model-value"]),g("div",{class:"install-view-installation-steps",ref_key:"stepsContainer",ref:i},[(c(!0),h(P,null,W(l.value,(b,m)=>(c(),h("div",{key:m,class:"install-view-installation-step"},[parseInt(m)===s.value?(c(),C(ne,{key:0,indeterminate:"",color:"primary",size:"20",width:"2",style:{overflow:"hidden"}})):(c(),C(N,{key:1,icon:"mdi-check-circle",color:"#097c31",size:"20"})),g("span",nt,B(b.replaceAll("_"," ")),1)]))),128))],512)]))}});const ot=k(lt,[["__scopeId","data-v-b87e48e3"]]),M={steps:[{title:"License",component:Te},{title:"System Environment Check",component:He},{title:"Database configuration",component:We},{title:"ElasticSearch configuration",component:Qe},{title:"Site configuration",component:at},{title:"Installation",component:ot}],db_collations:["utf8mb4_general_ci","utf8mb4_bin","utf8mb4_unicode_ci","utf8mb4_icelandic_ci","utf8mb4_latvian_ci","utf8mb4_romanian_ci","utf8mb4_slovenian_ci","utf8mb4_polish_ci","utf8mb4_estonian_ci","utf8mb4_spanish_ci","utf8mb4_swedish_ci","utf8mb4_turkish_ci","utf8mb4_czech_ci","utf8mb4_danish_ci","utf8mb4_lithuanian_ci","utf8mb4_slovak_ci","utf8mb4_spanish2_ci","utf8mb4_roman_ci","utf8mb4_persian_ci","utf8mb4_esperanto_ci","utf8mb4_hungarian_ci","utf8mb4_sinhala_ci","utf8mb4_german2_ci","utf8mb4_croatian_ci","utf8mb4_unicode_520_ci","utf8mb4_vietnamese_ci"]},U=ke("install-view",()=>{const d=Se(),o=f(!1),e=f(!1),l=f(!1),i=f(""),t=f(null),a=f(null),s=f(!1),r=f({dbname:"minthcm",host:"localhost",port:3306,username:"root",password:"",collation:"utf8mb4_general_ci"}),u=f({host:"localhost",port:9200,username:"",password:""}),b=f({url:window.location.href.split("#")[0],username:"admin",password:"",demodata:!1}),m=f(""),y=f(0),T=$(()=>M.steps[y.value]);async function E(){var _,w,v,F,L,X,K,Q,Y,Z;e.value=!0;try{const S=await x.get("api/install/init");i.value=(w=(_=S.data)==null?void 0:_.version)!=null?w:"",t.value=(F=(v=S.data)==null?void 0:v.license)!=null?F:"",a.value=(X=(L=S.data)==null?void 0:L.environment)!=null?X:"",s.value=(Q=(K=S.data)==null?void 0:K.isInstalling)!=null?Q:!1,e.value=!1,(Y=S.data)!=null&&Y.isInstalling&&(y.value=M.steps.length-1)}catch(S){((Z=S.response)==null?void 0:Z.status)===404&&d.push({name:"dashboard"})}}async function q(){var w,v;const _=await x.get("api/install/license");t.value=(v=(w=_.data)==null?void 0:w.license)!=null?v:""}async function z(){o.value=!0;const _=await x.get("api/install/init");_.data.environment&&(a.value=_.data.environment),o.value=!1}async function O(){var _,w;o.value=!0;try{const v=await x.post("api/install/validate_db",r.value);return o.value=!1,((_=v.data)==null?void 0:_.status)===0?(m.value=v.data.message,console.error((w=v.data.error)!=null?w:v.data.message),!1):!0}catch(v){return console.error(v),m.value="Server error",o.value=!1,!1}}async function j(){var _,w;o.value=!0;try{const v=await x.post("api/install/validate_elastic",u.value);return o.value=!1,((_=v.data)==null?void 0:_.status)===0?(m.value=v.data.message,console.error((w=v.data.error)!=null?w:v.data.message),!1):!0}catch(v){return console.error(v),m.value="Server error",o.value=!1,!1}}async function R(){var w,v,F;if(s.value==!0)return!0;const _=await x.post("api/install/submit",{db:r.value,elastic:u.value,site:b.value});if(typeof _.data=="string"||typeof _.data=="object"&&((w=_.data)==null?void 0:w.status)===0){const L=(F=(v=_.data.error)!=null?v:_.data.message)!=null?F:_.data;return m.value=L,console.error(L),!1}return l.value=!0,!0}function H(){y.value--}function de(){y.value++}return se(()=>y.value,()=>m.value=""),{currentStepNumber:y,currentStep:T,isInitialLoading:e,isLoading:o,isInstallationCompleted:l,version:i,license:t,environment:a,databaseConfig:r,elasticConfig:u,siteConfig:b,errorMsg:m,prevStep:H,nextStep:de,fetchLicense:q,recheckEnvironment:z,fetchInitialData:E,validateDb:O,validateElastic:j,install:R}}),it=d=>(ie("data-v-a7508c66"),d=d(),re(),d),rt={class:"install-view-completed"},ut=it(()=>g("h1",null,"Finished",-1)),dt=I({__name:"InstallViewCompleted",setup(d){function o(){location.reload()}return(e,l)=>(c(),h("div",rt,[ut,p(oe,{type:"success"},{default:D(()=>[le(" Your MintHCM installation is ready. Go ahead and log-in as an administrator. ")]),_:1}),p(J,{variant:"primary",text:"Go to login",style:{width:"100%"},onClick:o})]))}});const ct=k(dt,[["__scopeId","data-v-a7508c66"]]),ue=d=>(ie("data-v-a4e697cb"),d=d(),re(),d),mt={key:1,class:"install-view"},pt={class:"install-view-title"},vt=ue(()=>g("h1",null,"MintHCM Setup Wizard",-1)),_t={class:"install-view-container"},ft={key:0,class:"install-view-loader"},bt={class:"install-view-container-title"},gt={class:"install-view-buttons"},ht={class:"install-view-footer"},yt=ue(()=>g("div",{class:"install-view-footer"},[g("a",{href:"https://minthcm.org",target:"_blank"}," www.minthcm.org ")],-1)),wt=I({__name:"InstallView",setup(d){const o=U(),e=f(null),l=$(()=>{var s,r,u,b,m,y;return typeof((r=(s=e.value)==null?void 0:s.prevBtn)==null?void 0:r.label)=="string"?e.value.prevBtn.label:((b=(u=e.value)==null?void 0:u.prevBtn)==null?void 0:b.label)&&typeof((y=(m=e.value)==null?void 0:m.prevBtn)==null?void 0:y.label)=="object"?e.value.prevBtn.label.value:"Back"}),i=$(()=>{var s,r,u,b,m,y;return typeof((r=(s=e.value)==null?void 0:s.nextBtn)==null?void 0:r.label)=="string"?e.value.nextBtn.label:((b=(u=e.value)==null?void 0:u.nextBtn)==null?void 0:b.label)&&typeof((y=(m=e.value)==null?void 0:m.nextBtn)==null?void 0:y.label)=="object"?e.value.nextBtn.label.value:"Next"});ae(()=>{o.fetchInitialData()});function t(){var s,r;((s=e.value)==null?void 0:s.prevBtn)&&typeof e.value.prevBtn.action=="function"?(r=e.value)==null||r.prevBtn.action():o.prevStep()}function a(){var s,r,u;typeof((s=e.value)==null?void 0:s.validate)=="function"&&!e.value.validate()||(((r=e.value)==null?void 0:r.nextBtn)&&typeof e.value.nextBtn.action=="function"?(u=e.value)==null||u.nextBtn.action():o.nextStep())}return(s,r)=>{var u,b;return n(o).isInitialLoading?(c(),C(Ue,{key:0})):(c(),h("div",mt,[g("div",pt,[vt,g("span",null,"Version "+B(n(o).version),1)]),g("div",_t,[n(o).isInstallationCompleted?(c(),C(ct,{key:0})):(c(),h(P,{key:1},[p(Be,null,{default:D(()=>[n(o).isLoading?(c(),h("div",ft,[p(ne,{indeterminate:"",color:"primary",size:"64"})])):A("",!0)]),_:1}),g("div",bt,B(n(o).currentStep.title),1),n(o).errorMsg?(c(),C(oe,{key:0,type:"error"},{default:D(()=>[le(B(n(o).errorMsg),1)]),_:1})):A("",!0),p($e,{"hide-on-leave":""},{default:D(()=>{var m;return[(c(),C(Ee((m=n(o).currentStep)==null?void 0:m.component),{ref_key:"stepComponent",ref:e},null,512))]}),_:1}),g("div",gt,[((u=e.value)==null?void 0:u.prevBtn)!==!1&&n(o).currentStepNumber!==0?(c(),C(J,{key:0,variant:"text",text:l.value,onClick:t},null,8,["text"])):A("",!0),((b=e.value)==null?void 0:b.nextBtn)!==!1?(c(),C(J,{key:1,variant:"primary",text:i.value,onClick:a},null,8,["text"])):A("",!0)]),g("div",ht,[(c(!0),h(P,null,W(n(M).steps.length,m=>(c(),h("div",{key:m,class:Fe({"install-view-footer-dot":!0,"install-view-footer-dot-active":n(o).currentStepNumber===m-1})},null,2))),128))])],64))]),yt]))}}});const Mt=k(wt,[["__scopeId","data-v-a4e697cb"]]);export{Mt as default};
